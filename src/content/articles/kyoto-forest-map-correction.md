---
title: "京都府森林基本図の位置ずれ補正"
description: "京都府から提供を受けた森林基本図データに原因不明の位置ずれがあったため、Q地図タイル作成に当たって、線形近似によりずれを補正の上、公開しました。このページでは、ずれの発見から補正までの過程を説明します。"
date: 2023-07-16
type: post
---

2023年1月23日、京都府から府内全域の森林基本図データの提供を受けました。

提供を受けたワールドファイルを使って地図タイルを作成し[地理院地図](https://maps.gsi.go.jp/)と重ね合わせてみたところ、ずれが発生していることが分かりました。

紙地図をスキャンした地図をタイル化した場合、紙の歪みなどの要因により、若干のずれは生じますが、経験上、京都府の位置ずれは通常よりも大きなものでした。

全国Q地図では、できるだけ正確に位置合わせ（ジオリファレンス）を行ってタイルを作成する方針であるため、ずれの原因を特定し補正した上で公開することとしました。

## 提供されたデータ

京都府から提供を受けたデータは、TIF形式の画像ファイルと、そのワールドファイル（拡張子tfw）で、それぞれ482個です。

![](/images/図-1024x576.png)

図1　画像ファイルとワールドファイル

ワールドファイルとは、画像ファイルの位置（座標）を示すもので、ワールドファイルがあれば、GISソフトを使って画像ファイルを正しい位置に配置することができます。

京都府の森林基本図は、昭和37年度～平成2年度に作成されたものであるため、日本測地系で作成されています。提供されたワールドファイルの座標値は世界測地系の平面直角座標系第6系に変換済みでした。

## ずれの量の調査

ずれの量が地域によって異なるため、均等になるように配置した18地点のずれの量を調査しました。

調査方法は以下のとおりです。

1. 全国Q地図の外部タイル読み込み機能で京都府森林基本図タイルを読み込む
2. 日本測地系の平面直角座標系第6系500mごとに引かれた方眼線の交点の、平面直角座標（世界測地系）を読み取る
3. 読み取った世界測地系の平面直角座標を日本測地系の平面直角座標に変換する
4. 方眼の座標値と変換した座標値（いずれも日本測地系）の差分を計算する

この結果、X（南北）方向に最大約9m、Y（東西）方向に最大約18mのずれが生じていることが分かりました。

![](/images/スクリーンショット-2023-07-15-200628-1024x440.jpg)

図2　ずれの例。京都府森林基本図と地理院地図の重ね合わせ。左：補正前はずれている。右：ずれがない場合の表示。

## ずれの原因の調査

ずれが生じた原因を調査するために、以下のような理由でずれが生じたという仮説を立てて検証しましたが、いずれもずれを再現することはできませんでした。

**仮説1** 測地系変換に当たって国土地理院の変換プログラムを使用せずに、地域によらず一定の値を加算した

**仮説2** 測地系変換に当たって国土地理院の変換プログラム（TKY2JGD）を使用せずに、簡易な手法（EPSG）で変換した

また、京都府の担当部署においてもデータ作成時の記録が残っておらず、ずれが生じた原因は判明していません。

## ずれの傾向と補正

ずれの大きさは平面直角座標系の座標値によって変化し、X（南北）方向、Y（東西）方向ともに線形近似が可能であることが判明しました。

![](/images/スクリーンショット-2023-07-08-190406-1024x346.png)

図3　ずれの傾向。横軸は平面直角座標系第6系の座標値、縦軸はずれの量（m）。点線は線形近似。

以下の補正式を用いて、ワールドファイルの座標値を補正しました。

- X2 = X1 - X1 * 0.000114353 + 7.899848681
- Y2 = Y1 - Y1 * (-0.000116046) + 5.707504979

ここで、X1、Y1は補正前の座標、X2、Y2は補正後の座標を表します。

482個のワールドファイルを補正するために、Pythonにより自作のプログラムを作成し、一括変換を行いました。

## 補正前後の比較

補正前後の比較を図4に示します。精度良く補正できていることが分かります。

![](/images/スクリーンショット-2023-07-15-200125-1024x438.jpg)

![](/images/スクリーンショット-2023-07-15-200426-1024x440.jpg)

図4　補正前後の比較。左：補正前、右：補正後。地理院地図（等高線）と重ね合わせて確認。

2023年7月16日に京都府森林基本図を公開しました。

[京都府森林基本図を全国Q地図で見る](https://qchizu.jp/maps/#10/35.147424/135.579529/&base=std&ls=std%7C26p_kyoto_f_01&blend=0&disp=11&lcd=26p_kyoto_f_01&vs=c1g1j0h0k0l0u0t0z0r0s0m0f0)

京都府森林基本図の詳細については、[森林基本図](/forest-basemap)のページも御参照ください。
